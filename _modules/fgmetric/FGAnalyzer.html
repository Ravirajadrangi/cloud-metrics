
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>fgmetric.FGAnalyzer &mdash; Cloud Metrics 2.1.3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="Cloud Metrics 2.1.3 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
 

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11111']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  </head>
  <body>

<div style="background-image:url('_static/header_bg.png');background-color: black; text-align: left; padding: 10px 10px 15px 35px">
<table>
  <tr>
    <td>
      <a href="../../index.html"><img src="http://futuregrid.github.com/doc/_static/fg-logo-grid-glow.png" border="0" alt="FutureGrid Cloud Metric"/></a>
    </td>
    <td>
      <font size="5" color="white"><b><i>FutureGrid</i></b></font><br><br>
      <font size="10" color="white" face="Comic Sans MS"><b><i>Cloud Metric</i></b></font>
    </td>
  </tr>
</table>

</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
	<li><a href="../../index.html">Results</a>|&nbsp;</li>
        <li><a href="../../overview.html">Overview</a>|&nbsp;</li>
        <li><a href="../../about.html">About</a>|&nbsp;</li>
        <li><a href="../../installation.html">Installation</a>|&nbsp;</li>
        <li><a href="../../quickstart.html">Quick Start</a>|&nbsp;</li>
        <li><a href="../../details.html">Details</a>|&nbsp;</li>
        <li><a href="../../metrics.html">Metrics</a>|&nbsp;</li>
        <li><a href="../../man/index.html">Commands</a>|&nbsp;</li>
        <li><a href="../../download.html">Download</a>|&nbsp;</li>
        <li><a href="../../support.html">Support</a>|&nbsp;</li>
	<li><a href="../../ubmod.html">Results for HPC (UBMoD)</a>|&nbsp;</li>
        <li><a href="https://portal.futuregrid.org/">Portal</a>|&nbsp;</li>

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
<body style="background-image:url('_static/header_bg.png');background-color: grey;">
</body>

      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for fgmetric.FGAnalyzer</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. module:: FGAnalyzer</span>
<span class="sd">   :platform: Unix</span>
<span class="sd">   :synopsis: An analyzer of system utilization for the cloud based on the database collected by log files.</span>
<span class="sd">              It calculates metrics data and generates graph images like PNG files and html files with javascript.</span>

<span class="sd">.. moduleauthor:: Gregor von laszewski, Hyungro Lee &lt;lee212@indiana.edu&gt;</span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pygooglechart</span> <span class="kn">import</span> <span class="n">PieChart3D</span><span class="p">,</span> <span class="n">StackedHorizontalBarChart</span><span class="p">,</span> <span class="n">SimpleLineChart</span><span class="p">,</span> <span class="n">Axis</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">optparse</span>
<span class="kn">from</span> <span class="nn">cmd2</span> <span class="kn">import</span> <span class="n">Cmd</span><span class="p">,</span> <span class="n">make_option</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">Cmd2TestCase</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">unittest</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">fgmetric.FGParser</span> <span class="kn">import</span> <span class="n">Instances</span>
<span class="kn">from</span> <span class="nn">fgmetric.FGGoogleMotionChart</span> <span class="kn">import</span> <span class="n">FGGoogleMotionChart</span>
<span class="kn">from</span> <span class="nn">fgmetric.FGPygooglechart</span> <span class="kn">import</span> <span class="n">FGPyGoogleChart</span>
<span class="kn">from</span> <span class="nn">fgmetric.FGUtility</span> <span class="kn">import</span> <span class="n">FGUtility</span>
<span class="kn">from</span> <span class="nn">fgmetric.FGHighcharts</span> <span class="kn">import</span> <span class="n">FGHighcharts</span>
<span class="kn">from</span> <span class="nn">fgmetric.FGNovaMetric</span> <span class="kn">import</span> <span class="n">FGNovaMetric</span>
<span class="kn">from</span> <span class="nn">fgmetric.FGCharts</span> <span class="kn">import</span> <span class="n">FGCharts</span>

<div class="viewcode-block" id="CmdLineAnalyzeEucaData"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData">[docs]</a><span class="k">class</span> <span class="nc">CmdLineAnalyzeEucaData</span><span class="p">(</span><span class="n">Cmd</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This class analyzes utilization data to make a report</span>
<span class="sd">    </span>
<span class="sd">    It uses the extended python cmd package to support command-line iterpreter (CLI) programs.</span>

<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        Examples of this class are in the examples/ directory from the root repository of /futuregrid-cloud-metrics/</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">charttype</span> <span class="o">=</span> <span class="s">&quot;pie&quot;</span>
    <span class="n">from_date</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">to_date</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="n">day_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">echo</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">timing</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">userid</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">user_stats</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">sys_stats</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">sys_stat_new</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># sys_stats will be converted to this</span>

    <span class="n">platform</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">nodename</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">metric</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">nova</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">chart</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">output_format</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="n">groupby</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="CmdLineAnalyzeEucaData.calculate_stats"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.calculate_stats">[docs]</a>    <span class="k">def</span> <span class="nf">calculate_stats</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate user-based statstics about VM instances per user: count, min time, max time, avg time, total time</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            from_date (str): date to start calculation. Types are &#39;all&#39; or &#39;%Y-%m-%dT%H:%M:%S&#39;</span>
<span class="sd">            to_date (str): end date to finish calculation.</span>
<span class="sd">        Returns:</span>
<span class="sd">            n/a</span>
<span class="sd">        Raises:</span>
<span class="sd">            n/a</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">process_all</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">from_date</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;str&quot;</span><span class="p">):</span>
            <span class="n">process_all</span> <span class="o">=</span> <span class="p">(</span><span class="n">from_date</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">process_all</span><span class="p">:</span>
                <span class="n">date_from</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S&#39;</span><span class="p">)</span>
                <span class="n">date_to</span>   <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">to_date</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">from_date</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;None&quot;</span><span class="p">):</span>
            <span class="n">process_all</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">from_date</span><span class="p">)</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;datetime&quot;</span><span class="p">):</span>
            <span class="n">date_from</span> <span class="o">=</span> <span class="n">from_date</span>
            <span class="n">date_to</span> <span class="o">=</span> <span class="n">to_date</span>
            <span class="n">process_all</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">process_entry</span> <span class="o">=</span> <span class="n">process_all</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">process_all</span><span class="p">:</span>
                <span class="c">#process_entry = (values[&#39;ts&#39;] &gt;= date_from) and (values[&#39;ts&#39;] &lt; date_to)</span>
                <span class="n">process_entry</span> <span class="o">=</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s">&#39;t_end&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">date_from</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s">&#39;t_start&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">date_to</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">process_entry</span><span class="p">:</span>

                <span class="c"># If a nodename is set, stats is only for the compute cluster node specified</span>
                <span class="c">#if self.nodename and self.nodename != values[&#39;euca_hostname&#39;]:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s">&#39;hostname&#39;</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s">&quot;cloudplatform.platform&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="n">name</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s">&quot;ownerId&quot;</span><span class="p">]</span>
                <span class="n">t_delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s">&quot;duration&quot;</span><span class="p">])</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&quot;count&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="c"># number of instances</span>
                <span class="k">except</span><span class="p">:</span>
                <span class="c">#          count,sum,min,max,avg</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;count&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                                        <span class="s">&#39;runtime&#39;</span> <span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                                        <span class="s">&#39;min&#39;</span> <span class="p">:</span> <span class="n">t_delta</span><span class="p">,</span>
                                        <span class="s">&#39;max&#39;</span> <span class="p">:</span> <span class="n">t_delta</span><span class="p">,</span>
                                        <span class="s">&#39;avg&#39;</span> <span class="p">:</span> <span class="mf">0.0</span>
                                        <span class="p">}</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;runtime&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">t_delta</span>  <span class="c"># sum of time </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span> <span class="p">(</span><span class="n">t_delta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;min&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span> <span class="p">(</span><span class="n">t_delta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;max&#39;</span><span class="p">])</span>

                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;runtime&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;count&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.set_date"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.set_date">[docs]</a>    <span class="k">def</span> <span class="nf">set_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set search/analyze period</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            from_date (str): date to start calculation. &#39;%Y-%m-%dT%H:%M:%S&#39; is only allowed.</span>
<span class="sd">            to_date (str): end date to finish calculation.</span>
<span class="sd">        Returns:</span>
<span class="sd">            n/a</span>
<span class="sd">        Raises:</span>
<span class="sd">            n/a</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">to_date</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s">T%H:%M:%S&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">day_count</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_date</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;from and to date not specified.&quot;</span> 
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.get_user_stats"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.get_user_stats">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s">&quot;daily&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Call a private function &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stats</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.get_sys_stats"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.get_sys_stats">[docs]</a>    <span class="k">def</span> <span class="nf">get_sys_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s">&quot;daily&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Call a private function &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="n">metric</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stats</span><span class="p">(</span><span class="n">metric</span><span class="p">,</span> <span class="n">period</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="s">&quot;daily&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the list of calculated data</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            metric (str): a metric name to be analyzed (i.e. runtime, count, ccvm_cores, ccvm_mem, ccvm_disk)</span>
<span class="sd">            period (str): a search term (i.e. weekly, daily)</span>
<span class="sd">            username (str): a ownerid to be analyzed</span>
<span class="sd">        Returns:</span>
<span class="sd">            a list of numerical values of a metric for the search period range from the start date to the end date.</span>
<span class="sd">            Each element of the list indicates a statistical value for a day or a week depends on the period specified.</span>
<span class="sd">            For example, in the list of [0, 2, 5, ... 1], the 1st value (0) indicates a first day or a first week of the</span>
<span class="sd">            search period.</span>
<span class="sd">        Raises:</span>
<span class="sd">            n/a</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">merged_res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># instance based data</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">username</span> <span class="ow">and</span> <span class="n">username</span> <span class="o">!=</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;ownerId&quot;</span><span class="p">]</span> <span class="p">:</span>
                <span class="k">continue</span>
            <span class="c">#if self.nodename and self.nodename != instance[&quot;euca_hostname&quot;] :</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span> <span class="o">!=</span> <span class="n">instance</span><span class="p">[</span><span class="s">&#39;hostname&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;cloudplatform.platform&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_count_node</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="n">merged_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_daily_stats</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">merged_res</span><span class="p">,</span> <span class="s">&quot;sum&quot;</span><span class="p">)</span> <span class="c"># or &quot;avg&quot;</span>

        <span class="k">if</span> <span class="n">period</span> <span class="o">==</span> <span class="s">&quot;weekly&quot;</span><span class="p">:</span>
            <span class="n">merged_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_stats_from_daily_to_weekly</span><span class="p">(</span><span class="n">merged_res</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">merged_res</span>

    <span class="k">def</span> <span class="nf">_count_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Count nodes</span>

<span class="sd">        Args:</span>
<span class="sd">            instance(dict): instance </span>

<span class="sd">        Returns:</span>
<span class="sd">            n/a </span>
<span class="sd">        Raises:</span>
<span class="sd">            n/a</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">!=</span> <span class="s">&quot;count_node&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c">#sys_stat = self.stats.get(&#39;count_node&#39;)</span>
        <span class="n">sys_stat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">][</span><span class="s">&#39;count_node&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_start&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="ow">or</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_start&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;http://(.*):8775/axis2/services/EucalyptusNC&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;serviceTag&quot;</span><span class="p">]),</span> <span class="n">re</span><span class="o">.</span><span class="n">M</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span>
            <span class="n">nodename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">nodename</span> <span class="ow">in</span> <span class="n">sys_stat</span><span class="p">:</span>
                <span class="n">sys_stat</span><span class="p">[</span><span class="n">nodename</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys_stat</span><span class="p">[</span><span class="n">nodename</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sys_stat</span><span class="p">[</span><span class="n">nodename</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">][</span><span class="s">&#39;count_node&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys_stat</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;total_stats is not calculated.&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span>

<div class="viewcode-block" id="CmdLineAnalyzeEucaData.convert_stats_from_daily_to_weekly"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.convert_stats_from_daily_to_weekly">[docs]</a>    <span class="k">def</span> <span class="nf">convert_stats_from_daily_to_weekly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stats</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a daily list of calculated data to a weekly list of data in case the period specified with &#39;weekly&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            stats (list): a daily list of calculated data</span>
<span class="sd">        Returns:</span>
<span class="sd">            a shrinked list of data</span>
<span class="sd">        Raises:</span>
<span class="sd">            n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">weekly_stats</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span> <span class="o">/</span> <span class="mi">7</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats</span><span class="p">)):</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">weekly_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">weekly_stats</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">stats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">weekly_stats</span>
</div>
    <span class="k">def</span> <span class="nf">_daily_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">current_stats</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;sum&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">new_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_daily_stat</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Unexpected error:&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">raise</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge_daily_stat</span><span class="p">(</span><span class="n">new_stats</span><span class="p">,</span> <span class="n">current_stats</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
    
    <span class="k">def</span> <span class="nf">_daily_stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">metric</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of calculated data for the search period on a daily basis</span>

<span class="sd">        # This is going to be counting hours for daily</span>
<span class="sd">        # This logic is kind of messy but it should be changed/updated soon, Hopefully.</span>

<span class="sd">           Make a list filled with metric values in a daily basis.</span>
<span class="sd">           The size of the list is the date range of analyze. </span>
<span class="sd">           e.g. [0 (1st), 0 (2nd), ... , 0 (31th)] list will be </span>
<span class="sd">           returned when &#39;analyze -M 01&#39; which is for January 2012</span>
<span class="sd">           is requested. </span>

<span class="sd">        Args:</span>
<span class="sd">            instance(dict): Dictionary from the getdata() function of the class Instances. (instances.getdata())</span>
<span class="sd">            metric(str): runtime, count, ccvm_cores, ccvm_mem, and ccvm_disk are available</span>

<span class="sd">        Returns:</span>
<span class="sd">            a list of calculated data</span>
<span class="sd">            </span>
<span class="sd">        Raises:</span>
<span class="sd">            n/a</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">month</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day_count</span><span class="p">)</span> <span class="p">]</span>
        <span class="k">if</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_end&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="ow">or</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_start&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span> <span class="p">:</span>
            <span class="k">return</span> <span class="n">month</span>
        <span class="k">if</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_start&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_start&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="n">ins_start</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_start&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ins_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span>

        <span class="n">day_count_ins</span> <span class="o">=</span> <span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins_start</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">single_date</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ins_start</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">day_count_ins</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">single_date</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;runtime&quot;</span><span class="p">:</span>
                <span class="n">first_second_of_a_day</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">single_date</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s">&quot;00:00:00&quot;</span><span class="p">,</span> <span class="s">&quot;%H:%M:%S&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
                <span class="n">last_second_of_a_day</span> <span class="o">=</span> <span class="n">first_second_of_a_day</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># First day of instance (same with instance[&quot;t_start&quot;] and single_date)</span>
                    <span class="n">td</span> <span class="o">=</span> <span class="n">last_second_of_a_day</span> <span class="o">-</span> <span class="n">single_date</span>
                    <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
                    <span class="n">month</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">day_count_ins</span><span class="p">:</span> <span class="c"># Last day of instance (same day with instance[&quot;t_end&quot;] and single_date)</span>
                    <span class="n">td</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">first_second_of_a_day</span>
                    <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
                    <span class="n">month</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour</span>
                <span class="k">else</span><span class="p">:</span> <span class="c"># days between first and last days of instance</span>
                    <span class="n">month</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">24</span> <span class="c"># hours</span>
            <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;count&quot;</span><span class="p">:</span>
                <span class="n">month</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;ccvm_cores&quot;</span><span class="p">:</span>
                <span class="n">month</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;cores&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;ccvm_mem&quot;</span><span class="p">:</span>
                <span class="n">month</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;mem&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;ccvm_disk&quot;</span><span class="p">:</span>
                <span class="n">month</span><span class="p">[</span><span class="n">offset</span> <span class="o">+</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;disk&quot;</span><span class="p">])</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;runtime&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">day_count_ins</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">td</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="s">&quot;t_end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ins_start</span>
                <span class="n">hour</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">td</span><span class="o">.</span><span class="n">seconds</span><span class="p">)</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
                <span class="n">month</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour</span>
        <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;count&quot;</span> <span class="ow">and</span> <span class="n">day_count_ins</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">month</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;ccvm_cores&quot;</span> <span class="ow">and</span> <span class="n">day_count_ins</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">month</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;cores&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;ccvm_mem&quot;</span> <span class="ow">and</span> <span class="n">day_count_ins</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">month</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;mem&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;ccvm_disk&quot;</span> <span class="ow">and</span> <span class="n">day_count_ins</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">month</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">instance</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;disk&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">month</span>

    <span class="k">def</span> <span class="nf">_merge_daily_stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;sum&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merge daily_historam lists </span>
<span class="sd">            </span>
<span class="sd">            E.g. [1,2,3] + [2,3,4]</span>
<span class="sd">            expect =&gt; [ 1+2, 2+3, 3+4] = [ 3, 5, 7]</span>

<span class="sd">            Args:</span>
<span class="sd">                new(list): The new list for the stats</span>
<span class="sd">                current(list): The exist list of the stats</span>
<span class="sd">                type(str): The operation name of the merging which is one of sum (summation) or avg (average).</span>
<span class="sd">            Returns:</span>
<span class="sd">                a merged list from the new and current arguments</span>
<span class="sd">            Raises:</span>
<span class="sd">            n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">current</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day_count</span><span class="p">)</span> <span class="p">]</span>

        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;avg&quot;</span><span class="p">:</span>
            <span class="n">divide</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">divide</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="n">new</span><span class="p">,</span> <span class="n">current</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[(</span><span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">divide</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">array</span><span class="p">)]</span>

<div class="viewcode-block" id="CmdLineAnalyzeEucaData.line_chart"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.line_chart">[docs]</a>    <span class="k">def</span> <span class="nf">line_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_data</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create python Google Chart (line type) in a PNG file format&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_chart</span><span class="p">(</span><span class="n">chart_data</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">chart_type</span> <span class="o">=</span> <span class="s">&quot;line&quot;</span><span class="p">)</span>
       </div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.bar_chart"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.bar_chart">[docs]</a>    <span class="k">def</span> <span class="nf">bar_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_data</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create python Google Chart (bar type) in a PNG file format&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_chart</span><span class="p">(</span><span class="n">chart_data</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">chart_type</span> <span class="o">=</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_create_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_data</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">chart_type</span> <span class="o">=</span> <span class="s">&quot;line&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create python Google Chart in a PNG file format&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">maxY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">chart_data</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">chart</span> <span class="o">=</span> <span class="n">FGPyGoogleChart</span><span class="p">(</span><span class="n">chart_type</span><span class="p">,</span> <span class="n">maxY</span><span class="p">)</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">chart_data</span><span class="p">)</span>
            <span class="n">topY</span> <span class="o">=</span> <span class="n">maxY</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_yaxis</span><span class="p">([</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">topY</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">topY</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)))])</span>
    <span class="c">#        chart.set_xaxis([ str(x)+&quot;d&quot; for x in range(0, self.day_count + 1, ((self.day_count + 1) / 9))])</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_xaxis</span><span class="p">([</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">chart_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_output_path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_filename</span><span class="p">(</span><span class="n">chart_type</span> <span class="o">+</span> <span class="s">&quot;chart.png&quot;</span><span class="p">)</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
            <span class="k">print</span> <span class="n">chart</span><span class="o">.</span><span class="n">filepath</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">chart</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; created.&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;chart is not created.&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">pass</span>

<div class="viewcode-block" id="CmdLineAnalyzeEucaData.create_highcharts"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.create_highcharts">[docs]</a>    <span class="k">def</span> <span class="nf">create_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_data</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">chart_type</span> <span class="o">=</span> <span class="s">&quot;column&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create highcharts in a javascript html file format&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">highchart</span> <span class="o">=</span> <span class="n">FGHighcharts</span><span class="p">(</span><span class="n">chart_type</span><span class="p">)</span>
            <span class="n">highchart</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">chart_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span><span class="p">:</span>
                <span class="n">data_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_name</span> <span class="o">=</span> <span class="s">&quot;all&quot;</span>
            <span class="n">highchart</span><span class="o">.</span><span class="n">set_data_name</span><span class="p">(</span><span class="n">data_name</span><span class="p">)</span>
            <span class="n">highchart</span><span class="o">.</span><span class="n">set_subtitle</span><span class="p">(</span><span class="s">&quot;source : &quot;</span> <span class="o">+</span> <span class="n">data_name</span><span class="p">)</span>
            <span class="n">highchart</span><span class="o">.</span><span class="n">set_output_path</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;count_node&quot;</span><span class="p">:</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Total VMs count per a node cluster&quot;</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_xaxis</span><span class="p">(</span><span class="n">highchart</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_yaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">:</span> <span class="c"># This from user stats. display_stats</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_xaxis</span><span class="p">(</span><span class="n">highchart</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_yaxis</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_yaxis</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">)</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_xaxis</span><span class="p">([</span> <span class="n">d</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; ~ &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">day_count</span><span class="p">,</span> <span class="mi">7</span><span class="p">))])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">==</span> <span class="s">&quot;runtime&quot;</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="s">&quot; (hour) &quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Total &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">+</span> <span class="n">tmp</span> <span class="o">+</span> <span class="s">&quot; of VM instances&quot;</span>

            <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s">&quot;master-detail&quot;</span><span class="p">:</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_from_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">)</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_to_date</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">to_date</span><span class="p">)</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_height</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
                <span class="n">highchart</span><span class="o">.</span><span class="n">set_detail_date</span><span class="p">()</span>
            <span class="n">highchart</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">highchart</span><span class="o">.</span><span class="n">set_filename</span><span class="p">(</span><span class="n">chart_type</span> <span class="o">+</span> <span class="s">&quot;highcharts.html&quot;</span><span class="p">)</span>
            <span class="n">highchart</span><span class="o">.</span><span class="n">set_tooltip</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
            <span class="n">highchart</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
            <span class="k">print</span> <span class="n">highchart</span><span class="o">.</span><span class="n">filepath</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">highchart</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; created.&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;highcharts is not created.&quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">pass</span>
</div>
    <span class="k">def</span> <span class="nf">create_csvfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_data</span><span class="p">,</span> <span class="n">filepath</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">csv</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;text.csv&quot;</span>
            <span class="n">FGUtility</span><span class="o">.</span><span class="n">ensure_dir</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filepath</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">),</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">,</span>
                    <span class="n">quotechar</span><span class="o">=</span><span class="s">&quot;|&quot;</span><span class="p">,</span> <span class="n">quoting</span><span class="o">=</span><span class="n">csv</span><span class="o">.</span><span class="n">QUOTE_MINIMAL</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">list_of_data</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; is created&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s">&quot; not is created&quot;</span>
            <span class="k">pass</span>

        <span class="k">print</span> <span class="n">msg</span>

<div class="viewcode-block" id="CmdLineAnalyzeEucaData.display_stats"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.display_stats">[docs]</a>    <span class="k">def</span> <span class="nf">display_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;pie&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s">&quot;chart.png&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create Python Google Chart</span>
<span class="sd">           This should be merged to _create_chart()</span>
<span class="sd">        </span>
<span class="sd">            It displays the number of VMs per user</span>

<span class="sd">            Args:</span>
<span class="sd">                metric(str): metric name to display (e.g. count, )</span>
<span class="sd">                type(str): chart type (e.g. pie, bar)</span>
<span class="sd">                filepath(str): A location the output will be saved. It includes a directory path and a filename.</span>
<span class="sd">                               (other options are available e.g. display; open a browser, url; )</span>
<span class="sd">            Returns:</span>
<span class="sd">                n/a</span>
<span class="sd">            Raises:</span>
<span class="sd">                n/a</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">label_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">max_v</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">list_for_highchart</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_for_csv</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">list_for_csv</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&quot;owner id&quot;</span><span class="p">,</span> <span class="s">&quot;user name&quot;</span><span class="p">,</span> <span class="s">&quot;value for metric&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;nova&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;openstack&quot;</span><span class="p">):</span>
            <span class="n">user_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nova</span><span class="o">.</span><span class="n">users</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">user_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">user_list</span><span class="p">:</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">user_list</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span>
            <span class="c"># Temporary lines for converting sec to min </span>
            <span class="k">if</span> <span class="n">metric</span> <span class="o">!=</span> <span class="s">&quot;count&quot;</span><span class="p">:</span>
                <span class="n">number</span> <span class="o">=</span> <span class="nb">int</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">number</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_ownerId_str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
            <span class="n">label_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">list_for_highchart</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">label</span><span class="p">,</span> <span class="n">number</span><span class="p">])</span>
            <span class="n">list_for_csv</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_ownerId_str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">number</span><span class="p">])</span>
            <span class="n">max_v</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_v</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span>

        <span class="c">#self.generate_pygooglechart(type, label_values, max_v, values, filepath)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;highchart-column&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_highcharts</span><span class="p">(</span><span class="n">list_for_highchart</span><span class="p">,</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">metric</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span><span class="p">,</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&quot;csv&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_csvfile</span><span class="p">(</span><span class="n">list_for_csv</span><span class="p">,</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">metric</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.generate_pygooglechart"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.generate_pygooglechart">[docs]</a>    <span class="k">def</span> <span class="nf">generate_pygooglechart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chart_type</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">max_value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Create Python Google Chart but this should be merged to _create_chart()&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s">&quot;pie&quot;</span><span class="p">:</span> 
            <span class="n">chart</span> <span class="o">=</span> <span class="n">PieChart3D</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_pie_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chart_type</span> <span class="o">==</span> <span class="s">&quot;bar&quot;</span><span class="p">:</span>
            <span class="n">chart</span> <span class="o">=</span> <span class="n">StackedHorizontalBarChart</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="p">))</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
            <span class="c"># setting the x axis labels</span>
            <span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_value</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
            <span class="k">if</span> <span class="n">interval</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">interval</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">left_axis</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">interval</span><span class="p">)</span>
            <span class="n">left_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_axis_labels</span><span class="p">(</span><span class="n">Axis</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="n">left_axis</span><span class="p">)</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_bar_width</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">set_colours</span><span class="p">([</span><span class="s">&#39;00ff00&#39;</span><span class="p">,</span> <span class="s">&#39;ff0000&#39;</span><span class="p">])</span>

        <span class="n">chart</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="s">&quot;display&quot;</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span> <span class="p">(</span><span class="s">&quot;open &quot;</span> <span class="o">+</span> <span class="n">filepath</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filepath</span> <span class="o">==</span> <span class="s">&quot;url&quot;</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">chart</span><span class="o">.</span><span class="n">get_url</span><span class="p">()</span>
            <span class="k">print</span> <span class="n">url</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">FGUtility</span><span class="o">.</span><span class="n">ensure_dir</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
            <span class="n">chart</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.make_google_motion_chart"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.make_google_motion_chart">[docs]</a>    <span class="k">def</span> <span class="nf">make_google_motion_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create &quot;FGGoogleMotionChart.html&quot;</span>

<span class="sd">        * Should be obsolete due to the new way to display charts</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;FGGoogleMotionChart.html&quot;</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">directory</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">filename</span>
        <span class="n">FGUtility</span><span class="o">.</span><span class="n">ensure_dir</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">FGGoogleMotionChart</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_fullname</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">))</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s">&quot; created&quot;</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.convert_ownerId_str"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.convert_ownerId_str">[docs]</a>    <span class="k">def</span> <span class="nf">convert_ownerId_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a owner id to a user name</span>
<span class="sd">        </span>
<span class="sd">        * This should be working with retrieving ldap commands</span>
<span class="sd">        * Currently, this function is a test version</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;nova&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;openstack&quot;</span><span class="p">):</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_nova_userid_to_username</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">userinfo_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;ownerid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;last_name&#39;</span><span class="p">]</span>

        <span class="c"># Second try if it does not exist</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">userinfo_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;username&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;last_name&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;EJMBZFNPMDQ73AUDPOUS3&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;eucalyptus-admin&quot;</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">return</span> <span class="nb">id</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.convert_accountId_str"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.convert_accountId_str">[docs]</a>    <span class="k">def</span> <span class="nf">convert_accountId_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an account id to a user name</span>

<span class="sd">        * This should be working with retrieving ldap commands</span>
<span class="sd">        * Currently, this function is a test version</span>

<span class="sd">        # Temporarily add here </span>
<span class="sd">        # But it will be replaced by &#39;euare-accountlist|grep $accountid&#39;</span>
<span class="sd">        # e.g. euare-accountlist|grep fg82</span>
<span class="sd">        # fg82    281408815495</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">## TEST ONLY ~!!!!! ##</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;458299102773&quot;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;eucalyptus&quot;</span>
        <span class="k">elif</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;281408815495&quot;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;fg82&quot;</span>
        <span class="k">elif</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;000000000001&quot;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;system&quot;</span>
        <span class="k">elif</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;081364875274&quot;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;fg168&quot;</span>
        <span class="k">elif</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;150119767462&quot;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;fg3&quot;</span>
        <span class="k">elif</span> <span class="nb">id</span> <span class="o">==</span> <span class="s">&quot;355794507465&quot;</span> <span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;fg201&quot;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="nb">id</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.convert_nova_userid_to_username"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.convert_nova_userid_to_username">[docs]</a>    <span class="k">def</span> <span class="nf">convert_nova_userid_to_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a owner id to a user name</span>
<span class="sd">        </span>
<span class="sd">        * This should be working with retrieving ldap commands</span>
<span class="sd">        * Currently, this function is a test version</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nova</span><span class="o">.</span><span class="n">userinfo</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">element</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
</div>
    <span class="k">def</span> <span class="nf">set_fullname</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">uname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
            <span class="n">fullname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_ownerId_str</span><span class="p">(</span><span class="n">uname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">uname</span><span class="p">][</span><span class="s">&#39;fullname&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fullname</span>

    <span class="k">def</span> <span class="nf">realtime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>

        <span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">metric</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># Temporary for test</span>
        <span class="c">#self.instances.clear()</span>
        <span class="c">#self.instances.eucadb.change_table(&quot;instance_for_realtime&quot;)</span>
        <span class="c">#self.instances.read_from_db()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">count</span><span class="p">())):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c"># TEMPORARY</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s">&quot;date&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">27</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;Extant&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c">#if self.nodename and self.nodename != values[&#39;euca_hostname&#39;]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s">&#39;hostname&#39;</span><span class="p">]:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">!=</span> <span class="n">values</span><span class="p">[</span><span class="s">&quot;cloudplatform.platform&quot;</span><span class="p">]:</span>
                <span class="k">continue</span>

            <span class="n">ownerId</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s">&quot;ownerId&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ownerId</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
                <span class="n">metric_val</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">ownerId</span><span class="p">][</span><span class="n">metric</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metric_val</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">users</span><span class="p">[</span><span class="n">ownerId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">metric</span><span class="p">:</span> <span class="n">metric_val</span> <span class="p">}</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_ownerId_str</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="p">][</span><span class="n">metric</span><span class="p">])</span>
            <span class="k">print</span> <span class="n">FGUtility</span><span class="o">.</span><span class="n">convertOutput</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="s">&quot;realtime&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">preloop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_loaddb</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_loadnovadb</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="c"># Initialize values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;total&#39;</span> <span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;count_node&#39;</span> <span class="p">:</span> <span class="p">{}}</span>

        <span class="c">#self.stats = FGStats()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chart</span> <span class="o">=</span> <span class="n">FGCharts</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">postloop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span> <span class="s">&quot;BYE ...&quot;</span>

    <span class="c"># def do_server_start (self,arg):</span>
    <span class="c">#     os.system(&#39;lighttpd -D -f lighttpd.conf &amp;&#39;)</span>


    <span class="c"># def do_server_stop (self,arg):</span>
    <span class="c">#     os.system(&#39;killall lighttpd&#39;)</span>

<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_changecharttype"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_changecharttype">[docs]</a>    <span class="k">def</span> <span class="nf">do_changecharttype</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change the default caht type. You can choese bar, pie, motion&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">arg</span> <span class="o">!=</span> <span class="s">&quot;pie&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">arg</span> <span class="o">!=</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">arg</span> <span class="o">!=</span> <span class="s">&quot;motion&quot;</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&quot;Error: charttype &quot;</span> <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="s">&quot; not supported.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Setting chart type to &quot;</span> <span class="o">+</span> <span class="n">arg</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">charttype</span> <span class="o">=</span> <span class="n">arg</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--type&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;users&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-s&#39;</span><span class="p">,</span> <span class="s">&#39;--seperator&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;seperator between attribute and value&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">,</span> <span class="s">&#39;--caption&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;title of the table&quot;</span><span class="p">),</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_table"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_table">[docs]</a>    <span class="k">def</span> <span class="nf">do_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print a table from the instance data&quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="n">opts</span><span class="o">.</span><span class="n">caption</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">seperator</span> <span class="o">==</span> <span class="s">&quot;&quot;</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">seperator</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">seperator</span> <span class="o">=</span> <span class="s">&quot;=&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">seperator</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">seperator</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">caption</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">caption</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;# &quot;</span> <span class="o">+</span> <span class="n">opts</span><span class="o">.</span><span class="n">caption</span>
            <span class="k">print</span> <span class="s">&quot;# -----------------------------------------&quot;</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&quot;users&quot;</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">arg</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">seperator</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;count&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Error: Printing &lt;&quot;</span> <span class="o">+</span> <span class="n">opts</span><span class="o">.</span><span class="n">type</span> <span class="o">+</span> <span class="s">&quot;&gt; is not supported&quot;</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_loaddb"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_loaddb">[docs]</a>    <span class="k">def</span> <span class="nf">do_loaddb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Read the statistical data from MySQL database&quot;&quot;&quot;</span>
        
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s">... loading data from database&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="n">Instances</span><span class="p">()</span>
        <span class="c"># gets also data from the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">read_from_db</span><span class="p">()</span>

        <span class="c"># Gets also userinfo data from the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">read_userinfo_from_db</span><span class="p">()</span>

        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s">... data loaded&quot;</span>
</div>
    <span class="k">def</span> <span class="nf">do_loadnovadb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>

        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s">... loading data from nova database&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nova</span> <span class="o">=</span> <span class="n">FGNovaMetric</span><span class="p">()</span>
        <span class="c"># gets also data from the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nova</span><span class="o">.</span><span class="n">read_from_db</span><span class="p">()</span>

        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s">... data loaded&quot;</span>

<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_pause"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_pause">[docs]</a>    <span class="k">def</span> <span class="nf">do_pause</span><span class="p">(</span><span class="n">slef</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Wait for a return to be typed in with the keyboard&quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&quot;pause&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_dump"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_dump">[docs]</a>    <span class="k">def</span> <span class="nf">do_dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print the data from all instances.&quot;&quot;&quot;</span>
        <span class="c"># if we specify key, prints it from an instance with a given instance id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">dump</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_printlist"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_printlist">[docs]</a>    <span class="k">def</span> <span class="nf">do_printlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;List all instance ids id&#39;s&quot;&quot;&quot;</span>
        <span class="c"># takes as additional parameters fields to be printed</span>

        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">... list</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">print_list</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_clear"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_clear">[docs]</a>    <span class="k">def</span> <span class="nf">do_clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear all instance data and user data from the memory&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&quot;users&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&quot;instances&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&quot;all&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">day_count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">userid</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">user_stats</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_stats</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;total&#39;</span> <span class="p">:</span> <span class="s">&quot;&quot;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;count_node&#39;</span> <span class="p">:</span> <span class="p">{}}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nova</span><span class="o">.</span><span class="n">clear_stats</span><span class="p">()</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;--start&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;start time of the interval (type. YYYY-MM-DDThh:mm:ss)&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--end&#39;</span><span class="p">,</span>  <span class="n">default</span><span class="o">=</span><span class="s">&quot;all&quot;</span><span class="p">,</span>  <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;end time of the interval (type. YYYY-MM-DDThh:mm:ss)&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-M&#39;</span><span class="p">,</span> <span class="s">&#39;--month&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;month to analyze (type. MM)&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-Y&#39;</span><span class="p">,</span> <span class="s">&#39;--year&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;year to analyze (type. YYYY)&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-S&#39;</span><span class="p">,</span> <span class="s">&#39;--stats&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;metric&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;item name to measure (e.g. runtime, vms)&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-P&#39;</span><span class="p">,</span> <span class="s">&#39;--period&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;period&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;search period (weekly, daily)&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_analyze"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_analyze">[docs]</a>    <span class="k">def</span> <span class="nf">do_analyze</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Analyze utilization data</span>

<span class="sd">        This is main function to get statistical data</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Default set year and month by current date</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">analyze_year</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>  
        <span class="n">analyze_s_month</span> <span class="o">=</span> <span class="s">&quot;01&quot;</span>
        <span class="n">analyze_e_month</span> <span class="o">=</span> <span class="s">&quot;12&quot;</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">analyze_year</span><span class="p">:</span>
            <span class="n">analyze_e_month</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">year</span><span class="p">:</span>
            <span class="n">analyze_year</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">year</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
            <span class="n">analyze_s_month</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">month</span>
            <span class="n">analyze_e_month</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">month</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">year</span> <span class="ow">or</span> <span class="n">opts</span><span class="o">.</span><span class="n">month</span><span class="p">:</span>
            <span class="n">from_date</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-01T00:00:00&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">analyze_year</span><span class="p">,</span> <span class="n">analyze_s_month</span><span class="p">)</span>
            <span class="n">to_date</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">T23:59:59&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">analyze_year</span><span class="p">,</span> <span class="n">analyze_e_month</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">analyze_year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">analyze_e_month</span><span class="p">))[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">from_date</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">start</span>
            <span class="n">to_date</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">end</span>

        <span class="k">print</span> <span class="s">&quot;analyze [&quot;</span> <span class="o">+</span> <span class="n">from_date</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">to_date</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">set_date</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">)</span>
        <span class="c">#self.stats.set_search_date(from_date, to_date)</span>
        <span class="c">#self.stats.set_metric(opts.metric)</span>
        <span class="c">#self.stats.set_period(opts.period)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;now calculating&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calculate_stats</span> <span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">)</span>

        <span class="c"># new way to calculate metrics</span>
        <span class="c"># get_sys_stats return a list of daily values not specified by a user name</span>
        <span class="c"># It can display daily/weekly/monthly graphs for system utilization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sys_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sys_stats</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">metric</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">period</span><span class="p">)</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_stats</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nova</span><span class="o">.</span><span class="n">calculate_stats</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_getdaterange"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_getdaterange">[docs]</a>    <span class="k">def</span> <span class="nf">do_getdaterange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;Get Date range of the instances table in mysql db&quot;&quot;&quot;</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">getDateRange</span><span class="p">()</span>
        <span class="k">print</span> <span class="n">FGUtility</span><span class="o">.</span><span class="n">convertOutput</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;first_date&quot;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">FGUtility</span><span class="o">.</span><span class="n">convertOutput</span><span class="p">(</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;last_date&quot;</span><span class="p">)</span>
        <span class="c">#print self.instances.eucadb.read(&quot;&quot;, &quot; order by date limit 1&quot;)</span>
        <span class="c">#print self.instances.eucadb.read(&quot;&quot;, &quot; order by date DESC limit 1&quot;)</span>
</div>
    <span class="k">def</span> <span class="nf">do_printusers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">do_timing</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">do_echo</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">echo</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">do_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">arg</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">system</span> <span class="p">(</span><span class="s">&quot;open &quot;</span> <span class="o">+</span> <span class="n">arg</span><span class="p">)</span>

    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--type&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="n">charttype</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;pie, bar, motion&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;--filepath&#39;</span><span class="p">,</span> <span class="n">default</span> <span class="o">=</span> <span class="s">&quot;chart.png&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;the filepath in which we store a chart&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_creategraph"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_creategraph">[docs]</a>    <span class="k">def</span> <span class="nf">do_creategraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create PNG graphs (obsolete)&quot;&quot;&quot;</span>
        <span class="n">graph_type</span> <span class="o">=</span>  <span class="n">opts</span><span class="o">.</span><span class="n">type</span>
        <span class="n">filepath</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">filepath</span>
        <span class="k">print</span> <span class="n">graph_type</span> <span class="o">+</span> <span class="s">&quot; typed &quot;</span> <span class="o">+</span> <span class="n">filepath</span> <span class="o">+</span> <span class="s">&quot; file created&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_stats</span><span class="p">(</span><span class="s">&quot;all&quot;</span><span class="p">,</span> <span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="n">graph_type</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--directory&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;directory name which the chart html will be stored.&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_createhtml"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_createhtml">[docs]</a>    <span class="k">def</span> <span class="nf">do_createhtml</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create google motion chart (obsolete)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_google_motion_chart</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--directory&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;directory name which contains report graphs.&quot;</span><span class="p">),</span>
<span class="c">#        make_option(&#39;-t&#39;, &#39;--title&#39;, type=&quot;string&quot;, help=&quot;A report title in the index.html&quot;),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;--format&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;A report format. There are &#39;pie&#39;, &#39;bar&#39; and &#39;highchart-column&#39; chart types or &#39;csv&#39; format&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_createreport"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_createreport">[docs]</a>    <span class="k">def</span> <span class="nf">do_createreport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create PNG graphs which display statistics&quot;&quot;&quot;</span>

        <span class="n">default_format</span> <span class="o">=</span> <span class="s">&quot;highchart-column&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_format</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">format</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span><span class="p">:</span>
            <span class="n">output_format</span> <span class="o">=</span> <span class="n">default_format</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">output_format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span>
        <span class="c">#self.display_stats(&quot;count&quot;, &quot;pie&quot;, opts.directory + &quot;/pie.count.png&quot;)</span>
        <span class="c">#self.display_stats(&quot;count&quot;, &quot;bar&quot;, opts.directory + &quot;/bar.count.png&quot;)</span>
        <span class="c">#self.display_stats(&quot;sum&quot;, &quot;pie&quot;, opts.directory + &quot;/pie.sum.png&quot;)</span>
        <span class="c">#self.display_stats(&quot;sum&quot;, &quot;bar&quot;, opts.directory + &quot;/bar.sum.png&quot;)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">make_google_motion_chart</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_stats</span><span class="p">(</span><span class="s">&quot;count&quot;</span><span class="p">,</span> <span class="n">output_format</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_stats</span><span class="p">(</span><span class="s">&quot;runtime&quot;</span><span class="p">,</span> <span class="n">output_format</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;--start&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;start time of the interval (type. YYYY-MM-DDThh:mm:ss)&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--end&#39;</span><span class="p">,</span>  <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;end time of the interval (type. YYYY-MM-DDThh:mm:ss)&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-M&#39;</span><span class="p">,</span> <span class="s">&#39;--month&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;month to analyze (type. MM)&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-Y&#39;</span><span class="p">,</span> <span class="s">&#39;--year&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;year to analyze (type. YYYY)&quot;</span><span class="p">),</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_set_range"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_set_range">[docs]</a>    <span class="k">def</span> <span class="nf">do_set_range</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set search period (obsolete)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
            <span class="n">from_date</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">start</span>
            <span class="n">to_date</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">end</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">from_date</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-01T00:00:00&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>
            <span class="n">to_date</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">T23:59:59&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">monthrange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">month</span><span class="p">))[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">print</span> <span class="s">&quot;Set date range to analyze: [&quot;</span> <span class="o">+</span> <span class="n">from_date</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">to_date</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">set_date</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_search_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set search period</span>
<span class="sd">            # E.g. cmd) set search_range 2011-11-01T00:00:00 2012-05-14T23:59:59</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">from_date</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">to_date</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&quot;Set a date range to analyze: [&quot;</span> <span class="o">+</span> <span class="n">from_date</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span> <span class="o">+</span> <span class="n">to_date</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">set_date</span><span class="p">(</span><span class="n">from_date</span><span class="p">,</span> <span class="n">to_date</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_search_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_search_range</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_nodename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set node name</span>
<span class="sd">            E.g. cmd) set nodename india</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodename</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&quot;Set a nodename by to analyze: [&quot;</span> <span class="o">+</span> <span class="n">nodename</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span> <span class="o">=</span> <span class="n">nodename</span>

    <span class="k">def</span> <span class="nf">_set_platform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select platform (e.g. eucalyptus, openstack)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">platform</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">print</span> <span class="s">&quot;Set a platform by to analyze: [&quot;</span> <span class="o">+</span> <span class="n">platform</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="n">platform</span>

    <span class="k">def</span> <span class="nf">_set_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Select output format (e.g. bar, pie, and highchart-column chart types or csv format)&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">param</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="nb">str</span><span class="p">()):</span>
            <span class="n">format</span> <span class="o">=</span> <span class="n">param</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">format</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">print</span> <span class="s">&quot;A output format is set by :[&quot;</span> <span class="o">+</span> <span class="n">format</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">output_format</span> <span class="o">=</span> <span class="n">format</span>

    <span class="k">def</span> <span class="nf">_set_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set chart options (e.g. type, name, etc)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">function</span> <span class="o">=</span> <span class="s">&quot;set_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chart</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>
            <span class="n">func</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

            <span class="k">print</span> <span class="s">&quot;Set a chart option (&quot;</span> <span class="o">+</span> <span class="n">function</span> <span class="o">+</span> <span class="s">&quot;) to : &quot;</span> <span class="o">+</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_set_groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set grouping sets of values to get aggregate values divided by the group.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">groupby</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&quot;groupby is set by (&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">groupby</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;groupby isn&#39;t set due to an error (&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
            <span class="k">pass</span>

    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-u&#39;</span><span class="p">,</span> <span class="s">&#39;--user&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;user id to analyze&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-m&#39;</span><span class="p">,</span> <span class="s">&#39;--metric&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">&quot;runtime&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;metric name to display (runtime, vms)&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_analyze_user"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_analyze_user">[docs]</a>    <span class="k">def</span> <span class="nf">do_analyze_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Analyze user statistics&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;user id is required.&quot;</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_stats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user_stats</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">metric</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userid</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">user</span>

        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_stats</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="s">&#39;--output&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Filepath in which we store a chart&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_user_report"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_user_report">[docs]</a>    <span class="k">def</span> <span class="nf">do_user_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate a user report through Google line chart &quot;&quot;&quot;</span>

        <span class="c"># set default output by Year-month typed string</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>

        <span class="c"># user_stats has a user&#39;s data analyzed by &#39;analyze_user&#39; command.</span>
        <span class="c"># user_report requires prior execution of &#39;analyze_user&#39; command.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_chart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_stats</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="k">print</span>
        <span class="k">print</span> <span class="s">&quot;This line chart displays statistics of a specific user&#39;s metric.&quot;</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">userid</span> <span class="o">+</span> <span class="s">&quot; (userid) is selected to display &#39;instance runtime&#39; of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span>
        <span class="k">print</span> <span class="s">&quot;Y-axis indicates total running hours of instances.&quot;</span>
        <span class="k">print</span> <span class="s">&quot;X-axis indicates date of the month.&quot;</span>
        <span class="k">print</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="s">&#39;--output&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Filepath in which we store a chart&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-A&#39;</span><span class="p">,</span> <span class="s">&#39;--all&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;report all period data&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_sys_report"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_sys_report">[docs]</a>    <span class="k">def</span> <span class="nf">do_sys_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Generate system reports such as usage of CPU, memories, and disks.&quot;&quot;&quot;</span>

        <span class="c"># Set output directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">:</span>
            <span class="n">opts</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">from_date</span><span class="o">.</span><span class="n">month</span><span class="p">)</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        self.chart.set_output_path(opts.output)</span>

<span class="sd">        # Display metric: count_node</span>
<span class="sd">        try:</span>
<span class="sd">            self.chart.set_xaxis(self.sys_stat_new[&#39;total&#39;][&#39;count_node&#39;].keys())</span>
<span class="sd">            self.chart.set_yaxis(self.sys_stat_new[&#39;total&#39;][&#39;count_node&#39;].values())</span>
<span class="sd">            self.chart.display()</span>
<span class="sd">        except:</span>
<span class="sd">            pass</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="s">&#39;count_node&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">][</span><span class="s">&#39;count_node&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_stat_new</span><span class="p">[</span><span class="s">&#39;total&#39;</span><span class="p">][</span><span class="s">&#39;count_node&#39;</span><span class="p">],</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s">&quot;column&quot;</span><span class="p">)</span>
            <span class="k">return</span>
           
        <span class="bp">self</span><span class="o">.</span><span class="n">line_chart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_stats</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar_chart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_stats</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_stats</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">all</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_highcharts</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sys_stats</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="s">&quot;master-detail&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_filled_line_example"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_filled_line_example">[docs]</a>    <span class="k">def</span> <span class="nf">do_filled_line_example</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Example for python Google line chart&quot;&quot;&quot;</span>
        <span class="n">chart</span> <span class="o">=</span> <span class="n">PyGoogleChart</span><span class="p">(</span><span class="s">&quot;line&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">chart</span><span class="o">.</span><span class="n">filledLineExample</span><span class="p">()</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-u&#39;</span><span class="p">,</span> <span class="s">&#39;--user&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Show only image numbers owned by the userid specified.&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-d&#39;</span><span class="p">,</span> <span class="s">&#39;--detail&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Show details about images&quot;</span><span class="p">),</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-s&#39;</span><span class="p">,</span> <span class="s">&#39;--summary&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Show summary values about images&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_count_images"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_count_images">[docs]</a>    <span class="k">def</span> <span class="nf">do_count_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Count bucket images per user</span>

<span class="sd">            It is virtual machine image counts grouped by users or accounts based on euca2ools. </span>
<span class="sd">            It shows that which user or account currently owns how many virtual machine images on the system. </span>
<span class="sd">            This metric is based on the euca2ool command .euca-describe-images. that a eucalyptus user can see</span>
<span class="sd">            a list of machine images. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">subprocess</span>
        <span class="n">bucket_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">details</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">max_user</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">bin_path</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s">&quot;which&quot;</span><span class="p">,</span> <span class="s">&quot;euca-describe-images&quot;</span><span class="p">])</span>
        <span class="n">eucabin</span> <span class="o">=</span> <span class="n">bin_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s">&quot;python2.7&quot;</span><span class="p">,</span> <span class="n">eucabin</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="c"># Split the output by end-of-line chars.</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">chart_labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Loop through lines. The image path is the third item.</span>
        <span class="c"># Split by &quot;/&quot; to get bucket and key.</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">bucket</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
                <span class="c"># replace bucket with accountId - hrlee</span>
                <span class="c"># No reason to gather bucket name. Instead, accountid would be meaningful.</span>
                <span class="n">bucket</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot;(&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_accountId_str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">bucket_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">detail</span><span class="p">[</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span> 
                <span class="n">details</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span> <span class="o">=</span> <span class="n">detail</span>
                <span class="n">bucket_dict</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">bucket_dict</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_user</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">max_user</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bucket</span>
                    <span class="n">max_user</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bucket_dict</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">bucket_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">user</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">user</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)]))</span>
            <span class="n">chart_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="c"># Generate pygooglchart</span>
        <span class="n">chart_max_v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">bucket_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">))</span>
        <span class="n">chart_type</span> <span class="o">=</span> <span class="s">&quot;bar&quot;</span>
        <span class="n">chart_filepath</span> <span class="o">=</span> <span class="s">&quot;image_counts.png&quot;</span>
        <span class="n">chart_values</span> <span class="o">=</span> <span class="n">bucket_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generate_pygooglechart</span><span class="p">(</span><span class="n">chart_type</span><span class="p">,</span> <span class="n">chart_labels</span><span class="p">,</span> <span class="n">chart_max_v</span><span class="p">,</span> <span class="n">chart_values</span><span class="p">,</span> <span class="n">chart_filepath</span><span class="p">)</span>

        <span class="c"># show detail information of image owned by a specific user from -u, --user option</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">user</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">detail</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">details</span><span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">user</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">print</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span>

        <span class="c"># Show summary of images. i.e. number of total images, number of users, average numbers of images, and maximum numbers of images.</span>
        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">summary</span><span class="p">:</span>
            <span class="n">total_image_count</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># Except (-1) last \n line count</span>
            <span class="n">total_user_count</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bucket_dict</span><span class="p">))</span>
            <span class="k">print</span> <span class="s">&quot;&quot;</span>
            <span class="k">print</span> <span class="s">&quot;= Summary =&quot;</span>
            <span class="k">print</span> <span class="s">&quot;Total image counts:</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">total_image_count</span>
            <span class="k">print</span> <span class="s">&quot;Total user counts:</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">total_user_count</span>
            <span class="k">print</span> <span class="s">&quot;Average image counts per user:</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">total_image_count</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_user_count</span><span class="p">))</span>
            <span class="k">print</span> <span class="s">&quot;Maximum image counts and userid:</span><span class="se">\t</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">max_user</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; has &quot;</span> <span class="o">+</span>  <span class="nb">str</span><span class="p">(</span><span class="n">max_user</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">print</span> <span class="s">&quot;==========&quot;</span>
</div>
    <span class="nd">@options</span><span class="p">([</span>
        <span class="n">make_option</span><span class="p">(</span><span class="s">&#39;-u&#39;</span><span class="p">,</span> <span class="s">&#39;--user&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;Specify user name&quot;</span><span class="p">)</span>
        <span class="p">])</span>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_user_stats"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_user_stats">[docs]</a>    <span class="k">def</span> <span class="nf">do_user_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Print user statistics</span>

<span class="sd">            It is supposed to provide a user&#39;s statistics for a search period</span>
<span class="sd">            Not yet implemented.</span>

<span class="sd">        Prototype for usage</span>
<span class="sd">        #(cmd) user_stats -u username</span>
<span class="sd">        #period: 01/01/2011 ~ 01/01/2012</span>
<span class="sd">        #instances:</span>
<span class="sd">        #    total instances launched: 14</span>
<span class="sd">        #    total seconds used: 3600</span>
<span class="sd">        #    average ccvms (cores/mems/disks): 2, 512, 5</span>
<span class="sd">        #    min/max ccvms: 1/2, 512/6000, 5/15</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span> <span class="s">&quot;period:&quot;</span> <span class="o">+</span>  <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span> <span class="o">+</span> <span class="s">&quot; ~ &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span>

        <span class="c"># instances stats</span>
        <span class="k">print</span> <span class="s">&quot;instances:&quot;</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_set"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_set">[docs]</a>    <span class="k">def</span> <span class="nf">do_set</span> <span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set a function with parameter(s)&quot;&quot;&quot;</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">function</span> <span class="o">=</span> <span class="s">&quot;_set_&quot;</span> <span class="o">+</span> <span class="n">cmd</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">)</span>
            <span class="n">func</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

            <span class="k">print</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; is set for (&quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot; isn&#39;t set for (&quot;</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>
            <span class="k">pass</span>
        </div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_show"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_show">[docs]</a>    <span class="k">def</span> <span class="nf">do_show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Display realtime usage data&quot;&quot;&quot;</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">param</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">realtime</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">param</span><span class="p">)</span>

<span class="c">#########################################################</span>
<span class="c"># UNDER DEVELOPING</span>
<span class="c">#########################################################</span></div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.do_get"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.do_get">[docs]</a>    <span class="k">def</span> <span class="nf">do_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Perform an action to obtain possession of&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">param</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c">#param = args[1:]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">param</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">get_env</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CmdLineAnalyzeEucaData.get_env"><a class="viewcode-back" href="../../modules.html#fgmetric.FGAnalyzer.CmdLineAnalyzeEucaData.get_env">[docs]</a>    <span class="k">def</span> <span class="nf">get_env</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provide statistics&quot;&quot;&quot;</span>

        <span class="c"># check required fields</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">param</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">param</span> <span class="o">==</span> <span class="s">&quot;metric&quot;</span><span class="p">):</span>
            <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric</span> <span class="c">#is_exist(self.metric)</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodename</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">platform</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_date</span>
        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_date</span>
        <span class="c">#is_exist(self.groupby)</span>
        <span class="c">#is_exist(self.search_length_of_time)</span>
        <span class="c">#is_exist(self.search_interval)</span>

        <span class="c">#self.select_data_source(&quot;instance&quot;)</span>
</div>
    <span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_source</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">first_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s">&quot;groupby&quot;</span><span class="p">)</span>
        <span class="n">second_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s">&quot;metric&quot;</span><span class="p">)</span>
        <span class="n">third_column</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_val</span><span class="p">(</span><span class="s">&quot;search_interval&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="n">first_column</span><span class="p">:</span><span class="n">first_value</span><span class="p">,</span> <span class="n">second_column</span><span class="p">:</span><span class="n">second_value</span><span class="p">,</span> <span class="n">third_column</span><span class="p">:</span><span class="n">third_value</span><span class="p">}</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">()</span>

<span class="c">#####################################################################</span>
<span class="c"># main</span>
<span class="c">#####################################################################</span></div>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&#39;-t&#39;</span><span class="p">,</span> <span class="s">&#39;--test&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;unittests&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Run unit test suite&#39;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">callopts</span><span class="p">,</span> <span class="n">callargs</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">callopts</span><span class="o">.</span><span class="n">unittests</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">argv</span> <span class="o">=</span> <span class="p">[</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c"># the --test argument upsets unittest.main()</span>
        <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">CmdLineAnalyzeEucaData</span><span class="p">()</span>
        <span class="n">app</span><span class="o">.</span><span class="n">cmdloop</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
	<li><a href="../../index.html">Results</a>|&nbsp;</li>
        <li><a href="../../overview.html">Overview</a>|&nbsp;</li>
        <li><a href="../../about.html">About</a>|&nbsp;</li>
        <li><a href="../../installation.html">Installation</a>|&nbsp;</li>
        <li><a href="../../quickstart.html">Quick Start</a>|&nbsp;</li>
        <li><a href="../../details.html">Details</a>|&nbsp;</li>
        <li><a href="../../metrics.html">Metrics</a>|&nbsp;</li>
        <li><a href="../../man/index.html">Commands</a>|&nbsp;</li>
        <li><a href="../../download.html">Download</a>|&nbsp;</li>
        <li><a href="../../support.html">Support</a>|&nbsp;</li>
	<li><a href="../../ubmod.html">Results for HPC (UBMoD)</a>|&nbsp;</li>
        <li><a href="https://portal.futuregrid.org/">Portal</a>|&nbsp;</li>

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Gregor von Laszewski, Fugang Wang, Hyungro Lee, Javier Diaz.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>