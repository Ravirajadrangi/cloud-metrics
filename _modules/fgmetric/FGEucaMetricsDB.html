
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>fgmetric.FGEucaMetricsDB &mdash; Cloud Metrics 2.1.3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/issuetracker.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="top" title="Cloud Metrics 2.1.3 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
 

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11111']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


  </head>
  <body>

<div style="background-image:url('_static/header_bg.png');background-color: black; text-align: left; padding: 10px 10px 15px 35px">
<table>
  <tr>
    <td>
      <a href="../../index.html"><img src="http://futuregrid.github.com/doc/_static/fg-logo-grid-glow.png" border="0" alt="FutureGrid Cloud Metric"/></a>
    </td>
    <td>
      <font size="5" color="white"><b><i>FutureGrid</i></b></font><br><br>
      <font size="10" color="white" face="Comic Sans MS"><b><i>Cloud Metric</i></b></font>
    </td>
  </tr>
</table>

</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
	<li><a href="../../index.html">Results</a>|&nbsp;</li>
        <li><a href="../../overview.html">Overview</a>|&nbsp;</li>
        <li><a href="../../about.html">About</a>|&nbsp;</li>
        <li><a href="../../installation.html">Installation</a>|&nbsp;</li>
        <li><a href="../../quickstart.html">Quick Start</a>|&nbsp;</li>
        <li><a href="../../details.html">Details</a>|&nbsp;</li>
        <li><a href="../../metrics.html">Metrics</a>|&nbsp;</li>
        <li><a href="../../man/index.html">Commands</a>|&nbsp;</li>
        <li><a href="../../download.html">Download</a>|&nbsp;</li>
        <li><a href="../../support.html">Support</a>|&nbsp;</li>
	<li><a href="../../ubmod.html">Results for HPC (UBMoD)</a>|&nbsp;</li>
        <li><a href="https://portal.futuregrid.org/">Portal</a>|&nbsp;</li>

          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
<body style="background-image:url('_static/header_bg.png');background-color: grey;">
</body>

      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for fgmetric.FGEucaMetricsDB</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">pprint</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">ConfigParser</span>
<span class="kn">import</span> <span class="nn">MySQLdb</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">pp</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">(</span><span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">FGEucaMetricsDB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="c"># Default values</span>
    <span class="n">euca_version</span> <span class="o">=</span> <span class="s">&quot;3.0.2&quot;</span>
    <span class="n">euca_hostname</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">instance_table</span> <span class="o">=</span> <span class="s">&quot;instance&quot;</span>
    <span class="n">userinfo_table</span> <span class="o">=</span> <span class="s">&quot;userinfo&quot;</span>
    <span class="n">cloudplatform_table</span> <span class="o">=</span> <span class="s">&quot;cloudplatform&quot;</span>
    <span class="n">column_cp_ins</span> <span class="o">=</span> <span class="s">&quot;cloudPlatform&quot;</span>
    <span class="n">column_cp_cp</span> <span class="o">=</span> <span class="s">&quot;cloudPlatformId&quot;</span>

    <span class="c"># Initialize</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configfile</span><span class="o">=</span><span class="s">&quot;futuregrid.cfg&quot;</span><span class="p">):</span>

        <span class="c">#read config from file configfile</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">cfgfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&quot;HOME&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;/.futuregrid/&quot;</span> <span class="o">+</span> <span class="n">configfile</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">cfgfile</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c">#db parameters</span>
            <span class="n">dbhost</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EucaLogDB&#39;</span><span class="p">,</span> <span class="s">&#39;host&#39;</span><span class="p">)</span>
            <span class="n">dbport</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EucaLogDB&#39;</span><span class="p">,</span> <span class="s">&#39;port&#39;</span><span class="p">))</span>
            <span class="n">dbuser</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EucaLogDB&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">)</span>
            <span class="n">dbpasswd</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EucaLogDB&#39;</span><span class="p">,</span> <span class="s">&#39;passwd&#39;</span><span class="p">)</span>
            <span class="n">dbname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EucaLogDB&#39;</span><span class="p">,</span> <span class="s">&#39;db&#39;</span><span class="p">)</span>
            <span class="n">euca_hostname</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EucaLogDB&#39;</span><span class="p">,</span> <span class="s">&#39;euca_hostname&#39;</span><span class="p">)</span>
            <span class="n">euca_version</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;EucaLogDB&#39;</span><span class="p">,</span> <span class="s">&#39;euca_version&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">NoSectionError</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">cfgfile</span> <span class="o">+</span> <span class="s">&quot; does not exist&quot;</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c">#set parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">euca_version</span> <span class="o">=</span> <span class="n">euca_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">euca_hostname</span> <span class="o">=</span> <span class="n">euca_hostname</span>

        <span class="c">#connect to db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span> <span class="p">(</span><span class="n">dbhost</span><span class="p">,</span> <span class="n">dbuser</span><span class="p">,</span> <span class="n">dbpasswd</span><span class="p">,</span> <span class="n">dbname</span><span class="p">,</span> <span class="n">dbport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span> <span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>
        
        <span class="c">#create table if not exist</span>
        <span class="n">create_instance_table</span> <span class="o">=</span> <span class="s">&quot;create table if not exists &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span> <span class="o">+</span> <span class="s">&quot; (</span><span class="se">\</span>
<span class="s">                uidentifier VARCHAR(32) PRIMARY KEY NOT NULL, </span><span class="se">\</span>
<span class="s">                instanceId VARCHAR(16), </span><span class="se">\</span>
<span class="s">                ts DATETIME, </span><span class="se">\</span>
<span class="s">                calltype VARCHAR(32), </span><span class="se">\</span>
<span class="s">                userData VARCHAR(32), </span><span class="se">\</span>
<span class="s">                kernelId VARCHAR(32), </span><span class="se">\</span>
<span class="s">                emiURL VARCHAR(128), </span><span class="se">\</span>
<span class="s">                t_start DATETIME, </span><span class="se">\</span>
<span class="s">                t_end DATETIME, </span><span class="se">\</span>
<span class="s">                duration FLOAT, </span><span class="se">\</span>
<span class="s">                trace_pending_start DATETIME, </span><span class="se">\</span>
<span class="s">                trace_pending_stop DATETIME, </span><span class="se">\</span>
<span class="s">                trace_extant_start DATETIME, </span><span class="se">\</span>
<span class="s">                trace_extant_stop DATETIME, </span><span class="se">\</span>
<span class="s">                trace_teardown_start DATETIME, </span><span class="se">\</span>
<span class="s">                trace_teardown_stop DATETIME, </span><span class="se">\</span>
<span class="s">                serviceTag VARCHAR(128), </span><span class="se">\</span>
<span class="s">                groupNames VARCHAR(64), </span><span class="se">\</span>
<span class="s">                keyName VARCHAR(512), </span><span class="se">\</span>
<span class="s">                msgtype VARCHAR(16), </span><span class="se">\</span>
<span class="s">                volumesSize FLOAT, </span><span class="se">\</span>
<span class="s">                linetype VARCHAR(32), </span><span class="se">\</span>
<span class="s">                ownerId VARCHAR(32), </span><span class="se">\</span>
<span class="s">                date DATETIME, </span><span class="se">\</span>
<span class="s">                id INT, </span><span class="se">\</span>
<span class="s">                ncHostIdx INT, </span><span class="se">\</span>
<span class="s">                ccvm_mem INT, </span><span class="se">\</span>
<span class="s">                ccvm_cores INT, </span><span class="se">\</span>
<span class="s">                ccvm_disk INT, </span><span class="se">\</span>
<span class="s">                emiId VARCHAR(32), </span><span class="se">\</span>
<span class="s">                ccnet_publicIp VARCHAR(32), </span><span class="se">\</span>
<span class="s">                ccnet_privateMac VARCHAR(32), </span><span class="se">\</span>
<span class="s">                ccnet_networkIndex VARCHAR(32), </span><span class="se">\</span>
<span class="s">                ccnet_vlan VARCHAR(32), </span><span class="se">\</span>
<span class="s">                ccnet_privateIp VARCHAR(32), </span><span class="se">\</span>
<span class="s">                ramdiskURL VARCHAR(128), </span><span class="se">\</span>
<span class="s">                state VARCHAR(16), </span><span class="se">\</span>
<span class="s">                accountId VARCHAR(32), </span><span class="se">\</span>
<span class="s">                kernelURL VARCHAR(128), </span><span class="se">\</span>
<span class="s">                ramdiskId VARCHAR(32), </span><span class="se">\</span>
<span class="s">                volumes VARCHAR(32), </span><span class="se">\</span>
<span class="s">                launchIndex INT, </span><span class="se">\</span>
<span class="s">                platform VARCHAR(16), </span><span class="se">\</span>
<span class="s">                bundleTaskStateName VARCHAR(16), </span><span class="se">\</span>
<span class="s">                reservationId VARCHAR(32), </span><span class="se">\</span>
<span class="s">                euca_hostname VARCHAR(32), </span><span class="se">\</span>
<span class="s">                euca_version VARCHAR(32))&quot;</span>

        <span class="n">create_userinfo_table</span> <span class="o">=</span> <span class="s">&quot;create table if not exists &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">userinfo_table</span> <span class="o">+</span> <span class="s">&quot; (</span><span class="se">\</span>
<span class="s">                ownerid varchar(32) primary key not null, </span><span class="se">\</span>
<span class="s">                first_name varchar(32), </span><span class="se">\</span>
<span class="s">                last_name varchar(32), </span><span class="se">\</span>
<span class="s">                uid INT, </span><span class="se">\</span>
<span class="s">                username varchar(32), </span><span class="se">\</span>
<span class="s">                project varchar(16), </span><span class="se">\</span>
<span class="s">                hostname varchar(16))&quot;</span>

        <span class="n">create_cloudplatform_table</span> <span class="o">=</span> <span class="s">&quot;create table if not exists &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudplatform_table</span> <span class="o">+</span> <span class="s">&quot; (</span><span class="se">\</span>
<span class="s">                cloudPlatformId tinyint primary key auto_increment not null, </span><span class="se">\</span>
<span class="s">                hostname varchar(32), </span><span class="se">\</span>
<span class="s">                version varchar(8), </span><span class="se">\</span>
<span class="s">                platform varchar(16))&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_instance_table</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_userinfo_table</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_cloudplatform_table</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; destructor &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">astr</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; help function to format values to be inserted into mysql db &#39;&#39;&#39;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="n">astr</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_fillempty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">entry</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">entry</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querydict</span><span class="o">=</span><span class="p">{},</span> <span class="n">optional</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; read from the database &#39;&#39;&#39;</span>
        
        <span class="n">foreign_key_for_cloudplatform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_cp_ins</span> <span class="o">+</span> <span class="s">&quot;=&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudplatform_table</span> <span class="o">+</span> <span class="s">&quot;.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_cp_cp</span>
        <span class="n">querystr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">querydict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">querydict</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">querydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">astr</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;=&#39;&quot;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
                <span class="k">if</span> <span class="n">querystr</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">querystr</span> <span class="o">+=</span> <span class="s">&quot; and &quot;</span>
                <span class="n">querystr</span> <span class="o">+=</span> <span class="n">astr</span>            
                <span class="k">print</span> <span class="s">&quot;qstr:-&gt;&quot;</span> <span class="o">+</span> <span class="n">querystr</span> <span class="o">+</span> <span class="s">&quot;&lt;---&quot;</span>
                <span class="n">rquery</span> <span class="o">=</span> <span class="s">&quot;SELECT * FROM &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudplatform_table</span> <span class="o">+</span> <span class="s">&quot; where &quot;</span> <span class="o">+</span> <span class="n">foreign_key_for_cloudplatform</span> <span class="o">+</span> <span class="s">&quot; and &quot;</span> <span class="o">+</span> <span class="n">querystr</span> <span class="o">+</span> <span class="n">optional</span>
                <span class="c">#rquery = &quot;select * from instance, cloudplatform  where instance.cloudPlatform=cloudplatform.cloudPlatformId limit 5&quot;;    </span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rquery</span> <span class="o">=</span> <span class="s">&quot;SELECT * from &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cloudplatform_table</span> <span class="o">+</span> <span class="s">&quot; where &quot;</span> <span class="o">+</span> <span class="n">foreign_key_for_cloudplatform</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">optional</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">rquery</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">multikeys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">,</span> <span class="s">&quot;ccvm&quot;</span><span class="p">,</span> <span class="s">&quot;ccnet&quot;</span><span class="p">]</span>
        <span class="n">listvalues</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;groupNames&quot;</span><span class="p">,</span> <span class="s">&quot;volumes&quot;</span><span class="p">]</span>
        <span class="n">lrows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">arow</span> <span class="ow">in</span> <span class="n">lrows</span><span class="p">:</span>
            <span class="n">rowret</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">arow</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">multikeys</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_assignVal2Multi</span><span class="p">(</span><span class="n">rowret</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">arow</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">listvalues</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">arow</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">values</span> <span class="o">=</span> <span class="n">arow</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">)</span>
                        <span class="n">rowret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">rowret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rowret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">arow</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rowret</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">querydict</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; read from the database &#39;&#39;&#39;</span>
        
        <span class="n">querystr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">querydict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">querydict</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">querydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">astr</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;=&#39;&quot;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
                <span class="k">if</span> <span class="n">querystr</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">querystr</span> <span class="o">+=</span> <span class="s">&quot; and &quot;</span>
                <span class="n">querystr</span> <span class="o">+=</span> <span class="n">astr</span>            
                <span class="k">print</span> <span class="s">&quot;qstr:-&gt;&quot;</span> <span class="o">+</span> <span class="n">querystr</span> <span class="o">+</span> <span class="s">&quot;&lt;---&quot;</span>
                <span class="n">rquery</span> <span class="o">=</span> <span class="s">&quot;SELECT * FROM &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="s">&quot; where &quot;</span> <span class="o">+</span> <span class="n">querystr</span> <span class="o">+</span> <span class="n">optional</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rquery</span> <span class="o">=</span> <span class="s">&quot;SELECT * from &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="n">optional</span>
           
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">rquery</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MYSQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">arow</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arow</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">read_userinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querydict</span><span class="o">=</span><span class="p">{}):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userinfo_table</span><span class="p">,</span> <span class="n">querydict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querydict</span><span class="o">=</span><span class="p">{}):</span>
        <span class="n">querystr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">querydict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">querydict</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">querydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">astr</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;=&#39;&quot;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
                <span class="k">if</span> <span class="n">querystr</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">querystr</span> <span class="o">+=</span> <span class="s">&quot; and &quot;</span>
                <span class="n">querystr</span> <span class="o">+=</span> <span class="n">astr</span>            
                <span class="n">rquery</span> <span class="o">=</span> <span class="s">&quot;delete FROM &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span> <span class="o">+</span> <span class="s">&quot; where &quot;</span> <span class="o">+</span> <span class="n">querystr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rquery</span> <span class="o">=</span> <span class="s">&quot;delete from &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span>
        
	<span class="k">try</span><span class="p">:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">rquery</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
		<span class="k">pass</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">delete_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querydict</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span><span class="p">,</span> <span class="n">querydict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">delete_userinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querydict</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">userinfo_table</span><span class="p">,</span> <span class="n">querydict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">querydict</span><span class="p">):</span>

        <span class="n">querystr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">querydict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">querydict</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">querydict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="n">astr</span> <span class="o">=</span> <span class="n">key</span> <span class="o">+</span> <span class="s">&quot;=&#39;&quot;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
                <span class="k">if</span> <span class="n">querystr</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">querystr</span> <span class="o">+=</span> <span class="s">&quot; and &quot;</span>
                <span class="n">querystr</span> <span class="o">+=</span> <span class="n">astr</span>            
                <span class="n">rquery</span> <span class="o">=</span> <span class="s">&quot;delete FROM &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="s">&quot; where &quot;</span> <span class="o">+</span> <span class="n">querystr</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rquery</span> <span class="o">=</span> <span class="s">&quot;delete from &quot;</span> <span class="o">+</span> <span class="n">tablename</span> 
        
	<span class="k">try</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">rquery</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
            <span class="k">pass</span>
        
    <span class="k">def</span> <span class="nf">_assignVal2Multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themulti</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; help function to initialize(if necessary) and assign value to nested dict &#39;&#39;&#39;</span>
        <span class="n">tolevel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">curlevel</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nextlevel</span> <span class="o">=</span> <span class="n">curlevel</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">themulti</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">curlevel</span><span class="p">]):</span>
            <span class="n">themulti</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">curlevel</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">themulti</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">curlevel</span><span class="p">]]</span>
        <span class="k">while</span> <span class="n">nextlevel</span> <span class="o">&lt;</span> <span class="n">tolevel</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cur</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">keys</span><span class="p">[</span><span class="n">nextlevel</span><span class="p">]):</span>
                <span class="n">cur</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">nextlevel</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">cur</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">nextlevel</span><span class="p">]]</span>
            <span class="n">curlevel</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">nextlevel</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">cur</span><span class="p">[</span><span class="n">keys</span><span class="p">[</span><span class="n">nextlevel</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">cur</span>

    <span class="k">def</span> <span class="nf">value_todate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">string</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="s">&#39;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entryObj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; write instance object into db &#39;&#39;&#39;</span>
        <span class="n">uidcat</span> <span class="o">=</span> <span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;instanceId&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&quot; - &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ts&quot;</span><span class="p">])</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
        <span class="n">m</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">uidcat</span><span class="p">)</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">entryObj</span><span class="p">)</span>
        <span class="n">wquery</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span> <span class="o">+</span> <span class="s">&quot; ( uidentifier, </span><span class="se">\</span>
<span class="s">                                    instanceId, </span><span class="se">\</span>
<span class="s">                                    ts, </span><span class="se">\</span>
<span class="s">                                    calltype, </span><span class="se">\</span>
<span class="s">                                    userData, </span><span class="se">\</span>
<span class="s">                                    kernelId, </span><span class="se">\</span>
<span class="s">                                    emiURL, </span><span class="se">\</span>
<span class="s">                                    t_start, </span><span class="se">\</span>
<span class="s">                                    t_end, </span><span class="se">\</span>
<span class="s">                                    duration, </span><span class="se">\</span>
<span class="s">                                    trace_pending_start, </span><span class="se">\</span>
<span class="s">                                    trace_pending_stop, </span><span class="se">\</span>
<span class="s">                                    trace_extant_start, </span><span class="se">\</span>
<span class="s">                                    trace_extant_stop, </span><span class="se">\</span>
<span class="s">                                    trace_teardown_start, </span><span class="se">\</span>
<span class="s">                                    trace_teardown_stop, </span><span class="se">\</span>
<span class="s">                                    serviceTag, </span><span class="se">\</span>
<span class="s">                                    groupNames, </span><span class="se">\</span>
<span class="s">                                    keyName, </span><span class="se">\</span>
<span class="s">                                    msgtype, </span><span class="se">\</span>
<span class="s">                                    volumesSize, </span><span class="se">\</span>
<span class="s">                                    linetype, </span><span class="se">\</span>
<span class="s">                                    ownerId, </span><span class="se">\</span>
<span class="s">                                    date, </span><span class="se">\</span>
<span class="s">                                    id, </span><span class="se">\</span>
<span class="s">                                    ncHostIdx, </span><span class="se">\</span>
<span class="s">                                    ccvm_mem, </span><span class="se">\</span>
<span class="s">                                    ccvm_cores, </span><span class="se">\</span>
<span class="s">                                    ccvm_disk, </span><span class="se">\</span>
<span class="s">                                    emiId, </span><span class="se">\</span>
<span class="s">                                    ccnet_publicIp, </span><span class="se">\</span>
<span class="s">                                    ccnet_privateMac, </span><span class="se">\</span>
<span class="s">                                    ccnet_networkIndex, </span><span class="se">\</span>
<span class="s">                                    ccnet_vlan, </span><span class="se">\</span>
<span class="s">                                    ccnet_privateIp, </span><span class="se">\</span>
<span class="s">                                    ramdiskURL, </span><span class="se">\</span>
<span class="s">                                    state, </span><span class="se">\</span>
<span class="s">                                    accountId, </span><span class="se">\</span>
<span class="s">                                    kernelURL, </span><span class="se">\</span>
<span class="s">                                    ramdiskId, </span><span class="se">\</span>
<span class="s">                                    volumes, </span><span class="se">\</span>
<span class="s">                                    launchIndex, </span><span class="se">\</span>
<span class="s">                                    platform, </span><span class="se">\</span>
<span class="s">                                    bundleTaskStateName, </span><span class="se">\</span>
<span class="s">                                    reservationId, </span><span class="se">\</span>
<span class="s">                                    euca_hostname, </span><span class="se">\</span>
<span class="s">                                    euca_version ) </span><span class="se">\</span>
<span class="s">                            VALUES (&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;instanceId&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ts&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;calltype&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;userData&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;kernelId&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;emiURL&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;t_start&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;t_end&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;duration&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;pending&quot;</span><span class="p">][</span><span class="s">&quot;start&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;pending&quot;</span><span class="p">][</span><span class="s">&quot;stop&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;extant&quot;</span><span class="p">][</span><span class="s">&quot;start&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;extant&quot;</span><span class="p">][</span><span class="s">&quot;stop&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;teardown&quot;</span><span class="p">][</span><span class="s">&quot;start&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;teardown&quot;</span><span class="p">][</span><span class="s">&quot;stop&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;serviceTag&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;groupNames&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;keyName&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;msgtype&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;volumesSize&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;linetype&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ownerId&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;date&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ncHostIdx&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;mem&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;cores&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ccvm&quot;</span><span class="p">][</span><span class="s">&quot;disk&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;emiId&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ccnet&quot;</span><span class="p">][</span><span class="s">&quot;publicIp&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ccnet&quot;</span><span class="p">][</span><span class="s">&quot;privateMac&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ccnet&quot;</span><span class="p">][</span><span class="s">&quot;networkIndex&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ccnet&quot;</span><span class="p">][</span><span class="s">&quot;vlan&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;ccnet&quot;</span><span class="p">][</span><span class="s">&quot;privateIp&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;ramdiskURL&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;accountId&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;kernelURL&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;ramdiskId&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;volumes&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;launchIndex&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;platform&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fillempty</span><span class="p">(</span><span class="n">entryObj</span><span class="p">,</span> <span class="s">&quot;bundleTaskStateName&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;reservationId&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;euca_hostname&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">euca_hostname</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;euca_version&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">euca_version</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;)&quot;</span>


        <span class="n">wquery</span> <span class="o">+=</span> <span class="s">&quot; on duplicate key update &quot;</span> \
                <span class="o">+</span> <span class="s">&quot;t_end=&quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;t_end&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; duration=&quot;</span> \
                <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;duration&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; trace_pending_start=LEAST(trace_pending_start, &quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;pending&quot;</span><span class="p">][</span><span class="s">&quot;start&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;) ,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; trace_pending_stop=GREATEST(trace_pending_stop, &quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;pending&quot;</span><span class="p">][</span><span class="s">&quot;stop&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;) ,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; trace_extant_start=LEAST(trace_extant_start, &quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;extant&quot;</span><span class="p">][</span><span class="s">&quot;start&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;) ,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; trace_extant_stop=GREATEST(trace_extant_stop, &quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;extant&quot;</span><span class="p">][</span><span class="s">&quot;stop&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;) ,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; trace_teardown_start=LEAST(trace_teardown_start, &quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;teardown&quot;</span><span class="p">][</span><span class="s">&quot;start&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;) ,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; trace_teardown_stop=GREATEST(trace_teardown_stop, &quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;teardown&quot;</span><span class="p">][</span><span class="s">&quot;stop&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;) ,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; date=&quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;date&quot;</span><span class="p">]))</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> \
                <span class="o">+</span> <span class="s">&quot; state=&quot;</span> \
                <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fmtstr</span><span class="p">(</span><span class="n">entryObj</span><span class="p">[</span><span class="s">&quot;state&quot;</span><span class="p">])</span>

        <span class="c">#print wquery</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">wquery</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">write_userinfo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entryObj</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; write userinfo object into db &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write</span><span class="p">(</span><span class="s">&quot;userinfo&quot;</span><span class="p">,</span> <span class="n">entryObj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tablename</span><span class="p">,</span> <span class="n">entryObj</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">entryObj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">values</span> <span class="o">=</span> <span class="s">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s">&quot;&#39; ,&#39;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">entryObj</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span>
            <span class="n">wquery</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO &quot;</span> <span class="o">+</span> <span class="n">tablename</span> <span class="o">+</span> <span class="s">&quot; ( &quot;</span> <span class="o">+</span> <span class="n">keys</span> <span class="o">+</span> <span class="s">&quot; ) VALUES ( &quot;</span> <span class="o">+</span> <span class="n">values</span> <span class="o">+</span> <span class="s">&quot; )&quot;</span>
            <span class="c">#print wquery</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">pass</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">wquery</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">change_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">instance_table</span> <span class="o">=</span> <span class="n">table_name</span>
	    <span class="k">return</span>

<span class="k">def</span> <span class="nf">testing</span><span class="p">():</span>
    <span class="n">tstobj</span> <span class="o">=</span> <span class="s">&#39;{</span><span class="se">\</span>
<span class="s">        &quot;calltype&quot;: &quot;refresh_instances&quot;,</span><span class="se">\</span>
<span class="s">        &quot;userData&quot;: &quot;&quot;,</span><span class="se">\</span>
<span class="s">        &quot;kernelId&quot;: &quot;eki-78EF12D2&quot;,</span><span class="se">\</span>
<span class="s">        &quot;emiURL&quot;: &quot;http://149.165.146.135:8773/services/Walrus/centos53/centos.5-3.x86-64.img.manifest.xml&quot;,</span><span class="se">\</span>
<span class="s">        &quot;trace&quot;: {</span><span class="se">\</span>
<span class="s">            &quot;teardown&quot;: {</span><span class="se">\</span>
<span class="s">                &quot;start&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">                &quot;stop&quot;: &quot;2011-11-10 09:31:21&quot;</span><span class="se">\</span>
<span class="s">            },</span><span class="se">\</span>
<span class="s">            &quot;extant&quot;: {</span><span class="se">\</span>
<span class="s">                &quot;start&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">                &quot;stop&quot;: &quot;2011-11-10 09:28:30&quot;</span><span class="se">\</span>
<span class="s">            },</span><span class="se">\</span>
<span class="s">            &quot;pending&quot;: {</span><span class="se">\</span>
<span class="s">                &quot;start&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">                &quot;stop&quot;: &quot;2011-11-10 09:28:30&quot;</span><span class="se">\</span>
<span class="s">            }</span><span class="se">\</span>
<span class="s">        },</span><span class="se">\</span>
<span class="s">        &quot;serviceTag&quot;: &quot;http://i10:8775/axis2/services/EucalyptusNC&quot;,</span><span class="se">\</span>
<span class="s">        &quot;instanceId&quot;: &quot;i-534109B6&quot;,</span><span class="se">\</span>
<span class="s">        &quot;duration&quot;: &quot;9.0&quot;,</span><span class="se">\</span>
<span class="s">        &quot;t_start&quot;: &quot;2011-11-10 09:28:21&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ts&quot;: &quot;2011-11-10 09:28:21&quot;,</span><span class="se">\</span>
<span class="s">        &quot;groupNames&quot;: [</span><span class="se">\</span>
<span class="s">            &quot;default&quot;</span><span class="se">\</span>
<span class="s">        ],</span><span class="se">\</span>
<span class="s">        &quot;keyName&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCTu5lGYZr/XvkXlPW7d+/VKaZgaCb/n19uY9bZcGT7e7jshGjEUjVrhgNs7+fukoOLmwWDdg42KjyNf3P4W1O5AXdtpxQMNgCvjcv7joRjbBg8O7SE31uPvvy+ih8r/SBueAiRvzHDKPK5XV+H3v2V22302CkEt0V5YQSx6q1yGQOKhU7jCsK68dgguBaubf4N90G2UzvUFf1UAUocX80JSq/b3cH5/myEQqndazm/H3fMoBrUpn/GUvuyfeKlcbGct3Ho0eMQCrkKKRYsru/IdTqZhPGCYQPWUdR2mH9SD8QDpGdV9GOpIquTZqXhlIUKE7TNmLCoFZ9SOm3/tCGx admin@eucalyptus&quot;,</span><span class="se">\</span>
<span class="s">        &quot;msgtype&quot;: &quot;EUCADEBUG &quot;,</span><span class="se">\</span>
<span class="s">        &quot;volumesSize&quot;: &quot;0&quot;,</span><span class="se">\</span>
<span class="s">        &quot;linetype&quot;: &quot;print_ccInstance&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ownerId&quot;: &quot;admin&quot;,</span><span class="se">\</span>
<span class="s">        &quot;date&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">        &quot;id&quot;: &quot;011265&quot;,</span><span class="se">\</span>
<span class="s">        &quot;t_end&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ncHostIdx&quot;: &quot;8&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ccvm&quot;: {</span><span class="se">\</span>
<span class="s">            &quot;mem&quot;: &quot;512&quot;,</span><span class="se">\</span>
<span class="s">            &quot;cores&quot;: &quot;1&quot;,</span><span class="se">\</span>
<span class="s">            &quot;disk&quot;: &quot;5&quot;</span><span class="se">\</span>
<span class="s">        },</span><span class="se">\</span>
<span class="s">        &quot;emiId&quot;: &quot;emi-0B951139&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ccnet&quot;: {</span><span class="se">\</span>
<span class="s">            &quot;publicIp&quot;: &quot;149.165.159.130&quot;,</span><span class="se">\</span>
<span class="s">            &quot;privateMac&quot;: &quot;D0:0D:53:41:09:B6&quot;,</span><span class="se">\</span>
<span class="s">            &quot;networkIndex&quot;: &quot;4&quot;,</span><span class="se">\</span>
<span class="s">            &quot;vlan&quot;: &quot;10&quot;,</span><span class="se">\</span>
<span class="s">            &quot;privateIp&quot;: &quot;10.0.2.4&quot;</span><span class="se">\</span>
<span class="s">        },</span><span class="se">\</span>
<span class="s">        &quot;ramdiskURL&quot;: &quot;http://149.165.146.135:8773/services/Walrus/xeninitrd/initrd-2.6.27.21-0.1-xen.manifest.xml&quot;,</span><span class="se">\</span>
<span class="s">        &quot;state&quot;: &quot;Teardown&quot;,</span><span class="se">\</span>
<span class="s">        &quot;kernelURL&quot;: &quot;http://149.165.146.135:8773/services/Walrus/xenkernel/vmlinuz-2.6.27.21-0.1-xen.manifest.xml&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ramdiskId&quot;: &quot;eri-5BB61255&quot;,</span><span class="se">\</span>
<span class="s">        &quot;volumes&quot;: [</span><span class="se">\</span>
<span class="s">            &quot;&quot;</span><span class="se">\</span>
<span class="s">        ],</span><span class="se">\</span>
<span class="s">        &quot;launchIndex&quot;: &quot;0&quot;,</span><span class="se">\</span>
<span class="s">        &quot;reservationId&quot;: &quot;r-3DE7089D&quot;</span><span class="se">\</span>
<span class="s">        }&#39;</span>
    <span class="n">tstobj2</span> <span class="o">=</span> <span class="s">&#39;{</span><span class="se">\</span>
<span class="s">        &quot;calltype&quot;: &quot;refresh_instances&quot;,</span><span class="se">\</span>
<span class="s">        &quot;userData&quot;: &quot;&quot;,</span><span class="se">\</span>
<span class="s">        &quot;kernelId&quot;: &quot;eki-78EF12D2&quot;,</span><span class="se">\</span>
<span class="s">        &quot;emiURL&quot;: &quot;http://149.165.146.135:8773/services/Walrus/centos53/centos.5-3.x86-64.img.manifest.xml&quot;,</span><span class="se">\</span>
<span class="s">        &quot;trace&quot;: {</span><span class="se">\</span>
<span class="s">            &quot;teardown&quot;: {</span><span class="se">\</span>
<span class="s">                &quot;start&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">                &quot;stop&quot;: &quot;2011-11-10 09:31:21&quot;</span><span class="se">\</span>
<span class="s">            },</span><span class="se">\</span>
<span class="s">            &quot;extant&quot;: {</span><span class="se">\</span>
<span class="s">                &quot;start&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">                &quot;stop&quot;: &quot;2011-11-10 09:28:30&quot;</span><span class="se">\</span>
<span class="s">            },</span><span class="se">\</span>
<span class="s">            &quot;pending&quot;: {</span><span class="se">\</span>
<span class="s">                &quot;start&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">                &quot;stop&quot;: &quot;2011-11-10 09:28:30&quot;</span><span class="se">\</span>
<span class="s">            }</span><span class="se">\</span>
<span class="s">        },</span><span class="se">\</span>
<span class="s">        &quot;serviceTag&quot;: &quot;http://i10:8775/axis2/services/EucalyptusNC&quot;,</span><span class="se">\</span>
<span class="s">        &quot;instanceId&quot;: &quot;i-534109B9&quot;,</span><span class="se">\</span>
<span class="s">        &quot;duration&quot;: &quot;9.0&quot;,</span><span class="se">\</span>
<span class="s">        &quot;t_start&quot;: &quot;2011-11-10 09:28:21&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ts&quot;: &quot;2011-11-10 09:28:21&quot;,</span><span class="se">\</span>
<span class="s">        &quot;groupNames&quot;: [</span><span class="se">\</span>
<span class="s">            &quot;default&quot;,</span><span class="se">\</span>
<span class="s">            &quot;admin&quot;</span><span class="se">\</span>
<span class="s">        ],</span><span class="se">\</span>
<span class="s">        &quot;keyName&quot;: &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCTu5lGYZr/XvkXlPW7d+/VKaZgaCb/n19uY9bZcGT7e7jshGjEUjVrhgNs7+fukoOLmwWDdg42KjyNf3P4W1O5AXdtpxQMNgCvjcv7joRjbBg8O7SE31uPvvy+ih8r/SBueAiRvzHDKPK5XV+H3v2V22302CkEt0V5YQSx6q1yGQOKhU7jCsK68dgguBaubf4N90G2UzvUFf1UAUocX80JSq/b3cH5/myEQqndazm/H3fMoBrUpn/GUvuyfeKlcbGct3Ho0eMQCrkKKRYsru/IdTqZhPGCYQPWUdR2mH9SD8QDpGdV9GOpIquTZqXhlIUKE7TNmLCoFZ9SOm3/tCGx admin@eucalyptus&quot;,</span><span class="se">\</span>
<span class="s">        &quot;msgtype&quot;: &quot;EUCADEBUG &quot;,</span><span class="se">\</span>
<span class="s">        &quot;volumesSize&quot;: &quot;0&quot;,</span><span class="se">\</span>
<span class="s">        &quot;linetype&quot;: &quot;print_ccInstance&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ownerId&quot;: &quot;admin&quot;,</span><span class="se">\</span>
<span class="s">        &quot;date&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">        &quot;id&quot;: &quot;011265&quot;,</span><span class="se">\</span>
<span class="s">        &quot;t_end&quot;: &quot;2011-11-10 09:28:30&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ncHostIdx&quot;: &quot;8&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ccvm&quot;: {</span><span class="se">\</span>
<span class="s">            &quot;mem&quot;: &quot;512&quot;,</span><span class="se">\</span>
<span class="s">            &quot;cores&quot;: &quot;1&quot;,</span><span class="se">\</span>
<span class="s">            &quot;disk&quot;: &quot;5&quot;</span><span class="se">\</span>
<span class="s">        },</span><span class="se">\</span>
<span class="s">        &quot;emiId&quot;: &quot;emi-0B951139&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ccnet&quot;: {</span><span class="se">\</span>
<span class="s">            &quot;publicIp&quot;: &quot;149.165.159.130&quot;,</span><span class="se">\</span>
<span class="s">            &quot;privateMac&quot;: &quot;D0:0D:53:41:09:B6&quot;,</span><span class="se">\</span>
<span class="s">            &quot;networkIndex&quot;: &quot;4&quot;,</span><span class="se">\</span>
<span class="s">            &quot;vlan&quot;: &quot;10&quot;,</span><span class="se">\</span>
<span class="s">            &quot;privateIp&quot;: &quot;10.0.2.4&quot;</span><span class="se">\</span>
<span class="s">        },</span><span class="se">\</span>
<span class="s">        &quot;ramdiskURL&quot;: &quot;http://149.165.146.135:8773/services/Walrus/xeninitrd/initrd-2.6.27.21-0.1-xen.manifest.xml&quot;,</span><span class="se">\</span>
<span class="s">        &quot;state&quot;: &quot;Teardown&quot;,</span><span class="se">\</span>
<span class="s">        &quot;kernelURL&quot;: &quot;http://149.165.146.135:8773/services/Walrus/xenkernel/vmlinuz-2.6.27.21-0.1-xen.manifest.xml&quot;,</span><span class="se">\</span>
<span class="s">        &quot;ramdiskId&quot;: &quot;eri-5BB61255&quot;,</span><span class="se">\</span>
<span class="s">        &quot;volumes&quot;: [</span><span class="se">\</span>
<span class="s">            &quot;&quot;</span><span class="se">\</span>
<span class="s">        ],</span><span class="se">\</span>
<span class="s">        &quot;launchIndex&quot;: &quot;0&quot;,</span><span class="se">\</span>
<span class="s">        &quot;reservationId&quot;: &quot;r-3DE7089D&quot;</span><span class="se">\</span>
<span class="s">        }&#39;</span>
    <span class="n">testobj</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">tstobj</span><span class="p">)</span>
    <span class="n">testobj2</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">tstobj2</span><span class="p">)</span>
    <span class="n">eucadb</span> <span class="o">=</span> <span class="n">FGEucaMetricsDB</span><span class="p">(</span><span class="s">&quot;futuregrid.cfg.local&quot;</span><span class="p">)</span>
    <span class="n">eucadb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">testobj</span><span class="p">)</span>
    <span class="n">eucadb</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">testobj2</span><span class="p">)</span>
    <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;instanceId&quot;</span><span class="p">,</span> <span class="s">&quot;ownerId&quot;</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;i-534109B9&quot;</span><span class="p">,</span> <span class="s">&quot;admin&quot;</span><span class="p">]</span>
    <span class="n">qdict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span><span class="n">values</span><span class="p">))</span>
    <span class="n">records</span> <span class="o">=</span> <span class="n">eucadb</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">qdict</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">records</span>
    <span class="k">print</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;instanceId&quot;</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;teardown&quot;</span><span class="p">][</span><span class="s">&quot;start&quot;</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&quot;trace&quot;</span><span class="p">][</span><span class="s">&quot;teardown&quot;</span><span class="p">][</span><span class="s">&quot;stop&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="command_clean_database"><a class="viewcode-back" href="../../modules.html#fgmetric.FGEucaMetricsDB.command_clean_database">[docs]</a><span class="k">def</span> <span class="nf">command_clean_database</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MANUAL PAGE DRAFT</span>

<span class="sd">    NAME - fg-cleanup-table</span>

<span class="sd">    DESCRIPTION</span>

<span class="sd">    usage</span>
<span class="sd">	fg-cleanup-db &lt;arguments&gt;</span>

<span class="sd">    fg-cleanup-db</span>

<span class="sd">	-t tbl_name</span>
<span class="sd">	   deletes rows from tbl_name</span>

<span class="sd">	-d db_name</span>
<span class="sd">	   a database name of a table specified by -t tbl_name</span>

<span class="sd">	-w where_condition (optional)</span>
<span class="sd">	   specifies the conditions that identify which rows to delete</span>

<span class="sd">	--conf filename</span>
<span class="sd">	   configuraton file of the database to be used. The configuration file has the following format</span>
<span class="sd">	   </span>
<span class="sd">	   [EucaLogDB]</span>
<span class="sd">	   host=HOST</span>
<span class="sd">	   port=PORT</span>
<span class="sd">	   user=USER</span>
<span class="sd">	   passwd=PASS</span>
<span class="sd">	   db=DB</span>
<span class="sd">	   </span>
<span class="sd">	   if this parameter is not specified and a database is used the default location for this file is in</span>
<span class="sd">	   </span>
<span class="sd">	   ~/.futuregrid/futuregrid.cfg</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">def_table</span> <span class="o">=</span> <span class="s">&quot;instance&quot;</span>
    <span class="n">def_db</span> <span class="o">=</span> <span class="s">&quot;euca&quot;</span>
    <span class="n">def_conf</span> <span class="o">=</span> <span class="s">&quot;futuregrid.cfg.local&quot;</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-t&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;table_name&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_table</span><span class="p">,</span>
			<span class="n">help</span><span class="o">=</span><span class="s">&quot;table name to delete&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-d&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;db_name&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_db</span><span class="p">,</span>
			<span class="n">help</span><span class="o">=</span><span class="s">&quot;db name&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-w&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;where_clause&quot;</span><span class="p">,</span>
			<span class="n">help</span><span class="o">=</span><span class="s">&quot;WHERE clauses&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&quot;-C&quot;</span><span class="p">,</span> <span class="s">&quot;--conf&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;conf&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">def_conf</span><span class="p">,</span>
			<span class="n">help</span><span class="o">=</span><span class="s">&quot;configuraton file of the database to be used&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">eucadb</span> <span class="o">=</span> <span class="n">FGEucaMetricsDB</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">conf</span><span class="p">)</span>
    <span class="n">eucadb</span><span class="o">.</span><span class="n">change_table</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">table_name</span><span class="p">)</span>

    <span class="c"># where_clause need to be query dict type </span>
    <span class="n">query_dict</span><span class="o">=</span><span class="s">&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">eucadb</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">query_dict</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">command_clean_database</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>

      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
	<li><a href="../../index.html">Results</a>|&nbsp;</li>
        <li><a href="../../overview.html">Overview</a>|&nbsp;</li>
        <li><a href="../../about.html">About</a>|&nbsp;</li>
        <li><a href="../../installation.html">Installation</a>|&nbsp;</li>
        <li><a href="../../quickstart.html">Quick Start</a>|&nbsp;</li>
        <li><a href="../../details.html">Details</a>|&nbsp;</li>
        <li><a href="../../metrics.html">Metrics</a>|&nbsp;</li>
        <li><a href="../../man/index.html">Commands</a>|&nbsp;</li>
        <li><a href="../../download.html">Download</a>|&nbsp;</li>
        <li><a href="../../support.html">Support</a>|&nbsp;</li>
	<li><a href="../../ubmod.html">Results for HPC (UBMoD)</a>|&nbsp;</li>
        <li><a href="https://portal.futuregrid.org/">Portal</a>|&nbsp;</li>

          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Gregor von Laszewski, Fugang Wang, Hyungro Lee, Javier Diaz.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre.
    </div>
  </body>
</html>